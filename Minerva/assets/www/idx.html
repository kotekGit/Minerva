<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Minerva</title>
  <link rel="stylesheet" href="js/jquery.mobile-1.4.2/jquery.mobile-1.4.2.css">
  <link rel="stylesheet" href="css/main.css">
  
  <script src="js/jquery-1.11.1.min.js"></script>
  <script src="js/jquery.mobile-1.4.2/jquery.mobile-1.4.2.js"></script>
  <link rel="stylesheet" href="css/bootstrap.css">
  
  <script src="js/zaslepki/foldersList.js"></script>
  <script src="js/zaslepki/foldersIN.js"></script>
  
  <script src="js/messages.js"></script>
  <script src="js/pages/common.js"></script>
  <script src="js/pages/folder.js"></script>
  <!-- <script src="js/pages/home.js"></script> -->
  <script src="js/underscore.js"></script>
  <script src="js/backbone.js"></script>
</head>
<body>
	
<div data-role="page" class="ui-responsive-panel" data-theme="b" id="home" data-title="home" data-url="home">
    <div data-role="header">
        <h1>Foldery</h1>
        <a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>
        <a href="#add-form" data-icon="gear" data-iconpos="notext">Add</a>
    </div><!-- /header -->
    
    
    <div role="main" class="ui-content jqm-content jqm-fullwidth">
      	<div id="mainContainer"></div>
    </div><!-- /content -->
    
    
   <div data-role="popup" id="folderPopup" data-theme="a">
    <div data-role="content">
        <form class="folderForm">
            <label for="folderName">Name:</label>
            <input type="text" name="folderName" value="" data-clear-btn="true" data-mini="true">
            <label for="folderDesc">Description: </label>
            <textarea name="folderDesc"cols=20 rows=3 autocomplete="off" data-mini="true"></textarea>
            <div class="ui-grid-a">
                <div class="ui-block-a"><a href="#home" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-b ui-mini">Cancel</a></div>
                <div class="ui-block-b"><a href="#" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-a ui-mini">Save</a></div>
            </div>
        </form>
    </div>
  </div> 
  </div>
  
  
  
  
	
	
	<script type="text/template" id="folder-list-template">
		<a href="#/new"><button class="btn btn-large btn-block btn-success" type="button">NEW</button></a>
		<ul id="foldery" data-role="listview" data-split-icon="gear" data-theme="a"  data-inset="true">
		<% _.each(folders, function(folder) { %>
			<li><a href="#<%= folder.get('age')%> " data-transition="slide">
			<img src="css/walpers/bg1.jpg">
			<h2><%=folder.get('lastname')%></h2>
			<p><%=folder.get('firstname')%></p>
			<a href="#folderPopup" data-rel="popup" data-position-to="window" data-transition="pop" >EDYTUJ</a></li> 
		<% }); %>
		</ul>
	</script>
	
	<script type="text/template" id="addNewFolder-list-template">
	
				<form class="folderForm">
				<label for="folderName">Name:</label>
				<input type="text" name="folderName" value="" data-clear-btn="true" data-mini="true">
				<label for="folderDesc">Description: </label>
				<textarea name="folderDesc"cols=20 rows=3 autocomplete="off" data-mini="true"></textarea>
				<div class="ui-grid-a">
                <div class="ui-block-a"><a href="#home" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-b ui-mini">Cancel</a></div>
                <div class="ui-block-b"><a href="#" data-rel="close" class="ui-btn ui-shadow ui-corner-all ui-btn-a ui-mini">Save</a></div>
				</div>
				</form>
				
</script>

	
	
	
	
	
	
	
	<script>
	$.ajaxPrefilter( function( options, originalOptions, jqXHR ) {
		options.url = 'http://backbonejs-beginner.herokuapp.com' + options.url; 
	});
	
	$.fn.serializeObject = function() {
		var o = {};
		var a = this.serializeArray();
		$.each(a, function() {
			if (o[this.name] !== undefined) {
				if (!o[this.name].push) {
				o[this.name] = [o[this.name]];
				}
				o[this.name].push(this.value || '');
			} else {
				o[this.name] = this.value || '';
			}
		});
		return o;
	};
	
	
	var Folders = Backbone.Collection.extend({
		url: '/users'  /* DO ZMIANY /folders */
	});
	
	var FolderList = Backbone.View.extend({
		el : '#mainContainer',
		render: function() {
			var that = this;
			var folders = new Folders();
			folders.fetch({
				success: function(folders) {
					var template = _.template($("#folder-list-template").html(), {folders: folders.models});
					that.$el.html(template);
					$("#foldery").listview().listview("refresh");
				}
			});
		}
	});
	
	
	var AddNewFolder = Backbone.View.extend({
		el : '#mainContainer',
		render: function() {
			var template = _.template($("#addNewFolder-list-template").html(), {});
			this.$el.html(template);
		},
		events: {
			'submit .addNewFolderSubmit' : 'addFolderFn',
		},
		addFolderFn: function(event) {
			var folderDetails = $(event.currentTarget).serializeObject();
			return false; //stop refreshing
		}
	});


	
	
	
	
	var folderListView = new FolderList();
	var addNewFolderView = new AddNewFolder();
	
	
	
	var Router = Backbone.Router.extend({
		routes : {
			'' : 'home',
			'new' : 'addNewFolder'
		}
	});
	
	
	var router = new Router();
	router.on('route:home', function() {
		folderListView.render();
	});
	router.on('route:addNewFolder', function() {
		addNewFolderView.render();
	});
	
	Backbone.history.start();
	</script>

</body>
</html>